{"hierarchy":{"paths":[["doc:\/\/me.dropinwith.DropIn\/documentation\/DropIn"]]},"abstract":[{"text":"Learn how DropIn retrieves and manages nearby events using a geospatially optimized backend and a centralized in-app event store.","type":"text"}],"schemaVersion":{"minor":3,"patch":0,"major":0},"kind":"article","identifier":{"interfaceLanguage":"swift","url":"doc:\/\/me.dropinwith.DropIn\/documentation\/DropIn\/Fetching-Events"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/dropin\/fetching-events"]}],"primaryContentSections":[{"content":[{"level":2,"text":"Overview","type":"heading","anchor":"Overview"},{"inlineContent":[{"type":"text","text":"DropIn delivers a dynamic, location-aware event feed powered by an efficient and scalable event fetching mechanism. This mechanism ensures users see relevant events—both nearby and timely—whether they are browsing the map or scrolling through their home feed."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"At the heart of this system is the "},{"type":"strong","inlineContent":[{"code":"EventStore","type":"codeVoice"}]},{"type":"text","text":", a centralized, observable manager responsible for retrieving events from the backend and maintaining an up-to-date local cache for UI components to consume."}],"type":"paragraph"},{"type":"heading","anchor":"How-Event-Fetching-Works","text":"How Event Fetching Works","level":2},{"type":"heading","anchor":"1-Centralized-Event-Management","text":"1. Centralized Event Management","level":3},{"type":"paragraph","inlineContent":[{"text":"All events in the app are managed through an environment shared instance of ","type":"text"},{"code":"EventStore","type":"codeVoice"},{"text":". This class:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Fetches events from the backend (Supabase)"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Caches them locally in-memory"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Provides filtered subsets of events to views (e.g., joined events, nearby unjoined events)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Prunes expired events automatically"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This centralization ensures a consistent and performant experience across all views, while keeping network traffic minimal."}]},{"type":"heading","anchor":"2-Efficient-Geo-Queries-with-PostGIS","text":"2. Efficient Geo-Queries with PostGIS","level":3},{"type":"paragraph","inlineContent":[{"text":"The backend is backed by PostgreSQL with ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/postgis.net\/"},{"text":" enabled for spatial data support. Each event in the ","type":"text"},{"code":"events","type":"codeVoice"},{"text":" table stores its location as a ","type":"text"},{"code":"geography","type":"codeVoice"},{"text":" type column, enabling highly optimized spatial queries.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To find nearby events, the frontend calls a "},{"inlineContent":[{"type":"text","text":"remote procedure (RPC)"}],"type":"strong"},{"type":"text","text":" function exposed by Supabase. This function takes:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"A ","type":"text"},{"inlineContent":[{"type":"text","text":"center coordinate"}],"type":"strong"},{"text":" (","type":"text"},{"code":"latitude","type":"codeVoice"},{"text":", ","type":"text"},{"code":"longitude","type":"codeVoice"},{"text":")","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"A ","type":"text"},{"inlineContent":[{"type":"text","text":"search region"}],"type":"strong"},{"text":" (","type":"text"},{"code":"latitudeDelta","type":"codeVoice"},{"text":", ","type":"text"},{"code":"longitudeDelta","type":"codeVoice"},{"text":")","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Using spatial indexes on the location column, the RPC efficiently returns only events within the specified bounding box. This ensures low-latency queries, even with a large event dataset."}]},{"type":"heading","anchor":"3-View-Specific-Fetching-Behavior","text":"3. View-Specific Fetching Behavior","level":3},{"type":"heading","anchor":"Home-View-Feed","text":"Home View (Feed)","level":4},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Initially fetches events around the user’s location using a small delta.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"As the user scrolls through the event list, the ","type":"text"},{"code":"EventStore","type":"codeVoice"},{"text":" detects when more data is needed.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"It then "},{"inlineContent":[{"text":"increments the search delta","type":"text"}],"type":"strong"},{"type":"text","text":", effectively expanding the radius and fetching more events outward from the user’s location."}]}]}]},{"type":"paragraph","inlineContent":[{"text":"This creates an “infinite scroll” experience, while prioritizing nearby events first.","type":"text"}]},{"type":"heading","anchor":"Map-View","text":"Map View","level":4},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Events are fetched based on the ","type":"text"},{"type":"strong","inlineContent":[{"type":"text","text":"currently visible map camera region"}]},{"text":".","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Every time the map moves significantly, a new query is made with the updated center and span values."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"This ensures that the user always sees relevant, up-to-date event pins in their current view."}],"type":"paragraph"}]}]},{"type":"heading","anchor":"4-Filtering-and-Deduplication","text":"4. Filtering and Deduplication","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Once events are fetched:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Already-joined events are excluded from the general nearby feed."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Expired events (whose "},{"type":"codeVoice","code":"end"},{"type":"text","text":" time is in the past) are automatically pruned."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Duplicate fetches are avoided by comparing against previously fetched event IDs."}]}]}]},{"type":"heading","anchor":"Extensibility--Performance","text":"Extensibility & Performance","level":2},{"type":"paragraph","inlineContent":[{"text":"The fetching system is designed with scalability in mind:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The spatial RPC query can be easily adapted to support filters (e.g., categories, time ranges)."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Fetching logic is wrapped in async functions for seamless integration with Swift concurrency."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"The search delta approach in the home view gracefully balances "},{"type":"strong","inlineContent":[{"type":"text","text":"performance"}]},{"type":"text","text":" and "},{"type":"strong","inlineContent":[{"text":"relevance","type":"text"}]},{"type":"text","text":"."}],"type":"paragraph"}]}]},{"type":"heading","anchor":"Conclusion","text":"Conclusion","level":2},{"type":"paragraph","inlineContent":[{"text":"By combining a smart client-side store (","type":"text"},{"code":"EventStore","type":"codeVoice"},{"text":") with a geospatially optimized backend, DropIn ensures that users discover nearby events in a responsive and efficient way—whether they’re exploring spontaneously via the map or browsing curated lists in the home feed.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"This architecture lays a solid foundation for future growth, such as personalized sorting, trending events, or live filtering—all while keeping user experience fast and fluid.","type":"text"}]}],"kind":"content"}],"sections":[],"metadata":{"modules":[{"name":"DropIn"}],"role":"article","title":"Fetching Events","roleHeading":"Article"},"references":{"https://postgis.net/":{"titleInlineContent":[{"type":"text","text":"PostGIS"}],"url":"https:\/\/postgis.net\/","type":"link","title":"PostGIS","identifier":"https:\/\/postgis.net\/"},"doc://me.dropinwith.DropIn/documentation/DropIn":{"url":"\/documentation\/dropin","role":"collection","identifier":"doc:\/\/me.dropinwith.DropIn\/documentation\/DropIn","title":"DropIn","abstract":[{"type":"text","text":"Welcome to the official documentation for "},{"type":"strong","inlineContent":[{"text":"DropIn","type":"text"}]},{"type":"text","text":" — the spontaneous meetup app that brings people together in real time."}],"type":"topic","kind":"symbol"}}}